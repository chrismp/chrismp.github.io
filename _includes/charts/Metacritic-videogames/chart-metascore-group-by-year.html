<div id="normalized-stacked-bar-metascore-by-year" class="chart-container">
	
</div>

<script type="text/javascript">
function stackedBarMetascoreCategoriesByYear(){
	var container=			"normalized-stacked-bar-metascore-by-year";
	var containerTag=		'#'+container;
	var containerElement=	document.getElementById(container);
	var windowWidth=		containerElement.clientWidth;
	
	var chart=	{
		margin: {
			top: 0,
			right: 0,
			bottom: 0,
			left: 0
		},
		get width(){
			return windowWidth - this.margin.left - this.margin.right;
		},
		height: 1000,
		svg: d3.select(containerTag).append("svg"),
		get g(){
			return this.svg.append('g')
					.attr("transform", "translate("+this.margin.left+','+this.margin.top+')');
		},
		tooltip: d3.select(containerTag).append("div").attr("class","tooltip")
	}
	chart.svg
		.attr("width",chart.width)
		.attr("height",chart.height);

	var dataFilePath=	"{{site.baseurl}}/public/datasets/MetacriticVideoGames/chartData.MetascoreByYear.csv";
	d3.csv(dataFilePath, function(error,data){
		if(error) throw error;

		data.reverse();	// reverse order since by default a vertical chart puts bottom row of data at top of chart.

		var x=	{
			rangeRoundArray: [0,chart.width]
		}
		x=	d3.scaleLinear()
			.rangeRound(x.rangeRoundArray);

		var y=	{
			rangeRoundArray: [chart.height,0],
			padding: 0.1,
			align: 0.1
		}
		y=	d3.scaleBand()
			.rangeRound(y.rangeRoundArray)
			.padding(y.padding)
			.align(y.align);

		var colorGood=		"#6c3";
		var colorMixed=		"#fc3";
		var colorBad=		"#f00";
		var legendColors=	[
			colorBad,
			colorMixed,
			colorGood			
		];
		z=	d3.scaleOrdinal()
			.range(legendColors);

		var stack=	d3.stack()
					.offset(d3.stackOffsetExpand);

		y.domain(data.map(function(d){
			return d["ReleaseYear"];
		}));

		var targetColumns=	data.columns.slice(1,4)
		z.domain(targetColumns);	// Get columns at indices one thru three, which are the number of Good, Bad and Mixed

		var serie=	chart.g.selectAll(".serie")
					.data(stack.keys(targetColumns)(data))
					.enter()
					.append('g')
						.attr("class","serie")
						.attr("fill",function(d){
							return z(d.key);
						});

		serie.selectAll("rect")
			.data(function(d){
				return d;
			})
			.enter()
			.append("rect")
				.attr('y',function(d){
					return y(d.data["ReleaseYear"]);
				})
				.attr('x',function(d){
					return x(d[0]);
				})
				.attr("width",function(d){
					return x(d[1]) - x(d[0]);
				})
				.attr("height", y.bandwidth());

		// chart.g.append('g')
		// 	.attr("class", "axis axis--x")
		// 	.attr("transform", "translate(0,"+chart.height+')')
		// 	.call(d3.axisBottom(x));

		// chart.g.append('g')
		// 	.attr("class", "axis axis--y")
		// 	.call(d3.axisLeft(y).ticks(10,'%'));
	});
}

stackedBarMetascoreCategoriesByYear()
</script>